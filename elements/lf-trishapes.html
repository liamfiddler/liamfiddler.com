<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="elements.html">
<dom-module id="lf-trishapes">
	<template>
		<style>
			:host {
      	display: block;
				position: relative;
      }
			#canvas {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
			}
		</style>
    <div>
      	<canvas id="canvas" width="100%" height="100%"></canvas>
    </div>
	</template>
	<script>
		Polymer({
			is: 'lf-trishapes',
			properties: {
				stepX: {
					type: Number,
					value: 0,
				},
				stepY: {
					type: Number,
					value: 0,
				},
				frequency: {
					type: Number,
					value: .3,
				},
				phase: {
					type: Number,
					value: 2,
				},
				colorCenter: {
					type: Number,
					value: 200,
				},
				colorWidth: {
					type: Number,
					value: 55,
				},
			},
			attached: function() {
				if (this.stepX <= 0) {
					this.set('stepX', this.offsetWidth / (this.offsetWidth < 900 ? 4 : 8));
				}

				if (this.stepY <= 0) {
					this.set('stepY', this.offsetHeight / 4);
				}

				this.draw();
			},
			_yCoord: function(fromY) {
					var y = null;

					do {
							y = (fromY || this.offsetHeight / 2) + (Math.random() * 2 - 1) * (this.stepY * 2);
					} while (y > this.offsetHeight || y < 0);

					return y;
			},
			draw: function() {
					var newX, newY;
					var canvas = this.$.canvas;
					var context = canvas.getContext('2d');
					var pixelRatio = window.devicePixelRatio || 1;

					var coordinates = {
							from: {
									x: 0,
									y: this._yCoord()
							},
							to: {
									x: 0,
									y: this._yCoord()
							}
					};

					canvas.width = this.offsetWidth * pixelRatio; // this also clears the canvas!
					canvas.height = this.offsetHeight * pixelRatio;
					context.scale(pixelRatio, pixelRatio);

					for (var segment = Math.floor(Math.random() * this.colorCenter); coordinates.to.x < this.offsetWidth + this.stepX; segment++) {
							context.beginPath();
							context.moveTo(coordinates.from.x, coordinates.from.y);
							context.lineTo(coordinates.to.x, coordinates.to.y);

							newX = coordinates.to.x + (Math.random() * 2 - .25) * this.stepX;
							newY = this._yCoord(coordinates.to.y);

							context.lineTo(newX, newY);
							context.closePath();

							for (var color = [], i = 0; i < this.phase * 3; i += this.phase) {
									color.push(Math.round(Math.sin(this.frequency * segment + i) * this.colorWidth + this.colorCenter));
							}

							context.fillStyle = 'rgb(' + color.join(',') + ')';
							context.fill();

							coordinates = {
									from: coordinates.to,
									to: {
											x: newX,
											y: newY
									}
							};
					}
			},
		});
	</script>
</dom-module>
